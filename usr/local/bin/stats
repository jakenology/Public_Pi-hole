#!/usr/bin/env python
# Public Pi-hole Status 
import pihole as ph
import json

domain = "pi-hole4all.net"

resolvers = {
    "master": "red",
    "slaves": ["red","orange"]
}

stats = {
    "queries": "",
    "blocked": "",
    "percentage": ""
}
master = ''
slaves = []

def getHostnames():
    # Master Pi-hole
    master = '.'.join([(resolvers['master']), domain])

    # Slave Pi-holes
    for slave in resolvers['slaves']:
        hostname = '.'.join([slave, domain])
        slaves.append(hostname)

getHostnames()

def getStats():
    totalQueries = 0
    totalBlocked = 0    
    # Slaves
    for slave in slaves:
        slavePH = ph.PiHole(slave)
        queries = int((slavePH.queries).replace(',', ''))
        blocked = int((slavePH.blocked).replace(',', ''))
        totalQueries += queries
        totalBlocked += blocked
        percentage = round(totalBlocked / float(totalQueries), 6)
    stats['queries'] = totalQueries
    stats['blocked'] = totalBlocked
    stats['percentage'] = percentage
    print(json.dumps(stats))
getStats()
